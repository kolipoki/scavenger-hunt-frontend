<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scavenger Hunt</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
  <h1 class="text-3xl font-bold mb-6">Scavenger Hunt</h1>
  
  <p class="mb-4">Progress: <span id="counter">0/15</span></p>
  
  <button id="cameraBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
    Take Photo
  </button>

  <p id="message" class="mt-4 text-lg"></p>

<script>
const API_BASE = 'https://scavenger-hunt-worker.davidlosonczi.workers.dev/api';
const sessionId = localStorage.getItem('sessionId') || crypto.randomUUID();
localStorage.setItem('sessionId', sessionId);

const counterEl = document.getElementById('counter');
const messageEl = document.getElementById('message');

document.getElementById('cameraBtn').addEventListener('click', async () => {
  try {
    // Open camera and capture image
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    const video = document.createElement('video');
    video.srcObject = stream;
    await video.play();

    // Create a canvas to capture photo
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Stop camera
    stream.getTracks().forEach(track => track.stop());

    // Convert to blob
    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));

    // Prepare form data
    const formData = new FormData();
    formData.append('sessionId', sessionId);
    formData.append('file', blob, 'photo.jpg');

    // Send to Worker
    const res = await fetch(`${API_BASE}/upload`, { method: 'POST', body: formData });
    const data = await res.json();

    // Update UI
    messageEl.textContent = data.message;
    counterEl.textContent = `${data.progress}/15`;

    if (data.progress === 15) {
      alert('ðŸŽ‰ Congratulations! You found all hints!');
    }

  } catch (err) {
    console.error(err);
    messageEl.textContent = 'Error accessing camera or uploading photo.';
  }
});
</script>
</body>
</html>
